import{d as ue,b8 as de,y as u,a as J,b as c,o as m,f as h,a7 as pe,w as f,e,b9 as b,ba as y,B as ce,g as q,Z as D,a0 as L,t as o,ab as me,b7 as ve,K as he,bb as be}from"./index-CxWGQBUP.js";import{_ as ye,a as xe}from"./cut-CGHEqN9y.js";const fe={class:"p-4"},ge={class:"mb-6 border rounded-lg bg-gray-50 p-4"},_e={class:"flex flex-wrap items-center gap-3"},we={class:"mb-6"},ke={class:"w-full border-collapse text-sm"},Ce={class:"border px-3 py-2"},Me={class:"border px-3 py-2"},Te={class:"border px-3 py-2"},Ie={class:"border px-3 py-2"},Ne={class:"border px-3 py-2"},Ve=["onClick"],Fe={class:"mb-6 border rounded-lg bg-gray-50 p-4"},We={class:"flex flex-wrap items-center gap-3"},Se={class:"mb-6"},Ue={class:"w-full border-collapse text-sm"},qe={class:"border px-3 py-2"},ze={class:"border px-3 py-2"},Ae={class:"border px-3 py-2"},Be={class:"border px-3 py-2"},Ee={class:"border px-3 py-2"},Re=["onClick"],$e={class:"mb-6 flex gap-3"},He={key:0,id:"bins",class:"mt-8 space-y-6"},Pe={class:"text-xl font-semibold"},De={class:"bg-gray-100 p-3"},Le={class:"text-gray-800 font-semibold"},je={class:"text-sm text-gray-600"},Ke={key:0,class:"text-green-600"},Oe={key:1,class:"text-blue-600"},Xe={class:"flex flex-col items-center justify-center p-6"},Qe=ue({name:"cut_plane",__name:"index",setup(Ze){const $=de(),g=u(""),_=u(null),w=u(null),k=u(1),V=u(""),C=u(null),M=u(null),F=u(1),d=u([]),x=u([]),v=u([]),H=u([]),z=u(!1),j=J(()=>d.value.reduce((r,t)=>r+t.quantity,0)),Q=J(()=>d.value.reduce((r,t)=>r+t.width*t.height*t.quantity,0)),A=r=>r.materialType?x.value.some(t=>r.materialType?.startsWith(t.name)):!1;function K(){if(!g.value||_.value===null||w.value===null||k.value<1||_.value<=0||w.value<=0){$.error("ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÈ°πÁõÆÂèÇÊï∞ÔºÅ");return}const r=d.value.findIndex(t=>t.label===g.value);r!==-1?d.value[r].quantity=k.value:d.value.push({label:g.value,width:_.value,height:w.value,quantity:k.value}),le()}function O(){if(!V.value||C.value===null||M.value===null||F.value<1||C.value<=0||M.value<=0){$.error("ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊùêÊñôÂèÇÊï∞ÔºÅ");return}x.value.push({name:V.value,width:C.value,height:M.value,count:F.value}),se()}function Y(r){d.value.splice(r,1)}function ee(r){x.value.splice(r,1)}function te(){d.value=[],x.value=[],v.value=[],H.value=[]}function le(){g.value="",_.value=null,w.value=null,k.value=1}function se(){V.value="",C.value=null,M.value=null,F.value=1}async function ae(){if(d.value.length===0){$.error("ËØ∑ÂÖàÊ∑ªÂä†Ëá≥Â∞ë‰∏Ä‰∏™ÂàáÂâ≤È°πÁõÆÔºÅ");return}const r=d.value.flatMap(a=>Array.from({length:a.quantity},(p,I)=>({label:`${a.label}_${I+1}`,width:a.width/100,height:a.height/100}))),t=x.value.map(a=>({name:a.name,width:a.width/100,height:a.height/100,availableCount:a.count}));try{z.value=!0;const a=await xe({items:r,materials:t});v.value=a,setTimeout(()=>{T()},100)}catch{}finally{z.value=!1}function T(){const a=Math.max(...v.value.map(n=>n.materialWidth)),p=Math.max(...v.value.map(n=>n.materialHeight)),I=400,l=Math.min(I/(a*100),I/(p*100))*100;H.value.forEach((n,W)=>{const B=v.value[W];if(!n)return;const s=n.getContext("2d"),X=B.materialWidth*100,Z=B.materialHeight*100,E=X*l/100,R=Z*l/100;n.width=E,n.height=R;const oe=A(B);s.fillStyle=oe?"#e8f5e8":"#e3f2fd",s.fillRect(0,0,E,R),s.strokeStyle="#333",s.lineWidth=2,s.strokeRect(0,0,E,R),s.strokeStyle="#bbb",s.lineWidth=1;for(let i=0;i<=X;i+=10){const N=i*l/100;s.beginPath(),s.moveTo(N,0),s.lineTo(N,R),s.stroke()}for(let i=0;i<=Z;i+=10){const N=i*l/100;s.beginPath(),s.moveTo(0,N),s.lineTo(E,N),s.stroke()}B.pieces.forEach(i=>{const ne=`hsl(${Math.floor(Math.random()*360)}, 70%, 80%)`,S=i.x*100*l/100,U=i.y*100*l/100,P=i.w*100*l/100,G=i.h*100*l/100;s.fillStyle=ne,s.fillRect(S,U,P,G),s.strokeStyle="#333",s.lineWidth=1,s.strokeRect(S,U,P,G),s.fillStyle="rgba(0,0,0,0.8)";const re=Math.min(P-4,120);s.fillRect(S+2,U+2,re,36),s.fillStyle="white",s.font="12px Arial",s.fillText(i.label,S+6,U+16);const ie=`${(i.w*100).toFixed(1)}√ó${(i.h*100).toFixed(1)}cm`;s.font="11px Arial",s.fillText(ie,S+6,U+30)})})}he(()=>{window.addEventListener("keypress",a=>{if(a.key==="Enter"){const p=document.activeElement;["INPUT","TEXTAREA"].includes(p?.tagName||"")&&(p&&["label","width","height","quantity"].includes(p.id)?K():p&&["materialName","materialWidth","materialHeight","materialCount"].includes(p.id)&&O())}})})}return(r,t)=>{const T=ce,a=me,p=ye,I=ve;return m(),c("div",fe,[h(a,{title:"ÊùêÊñôË£ÅÂâ™ÂèØËßÜÂåñ",size:"large",class:"mb-4"},{default:f(()=>[e("section",ge,[t[10]||(t[10]=e("h3",{class:"mb-3 text-lg font-semibold"},"Ë£ÅÂâ™Â∞∫ÂØ∏",-1)),e("div",_e,[b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>g.value=l),type:"text",placeholder:"Ê†áÁ≠æ",class:"border rounded px-3 py-2"},null,512),[[y,g.value]]),b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>_.value=l),type:"number",placeholder:"ÂÆΩ(cm)",step:"0.1",min:"0.1",class:"w-24 border rounded px-3 py-2"},null,512),[[y,_.value,void 0,{number:!0}]]),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>w.value=l),type:"number",placeholder:"È´ò(cm)",step:"0.1",min:"0.1",class:"w-24 border rounded px-3 py-2"},null,512),[[y,w.value,void 0,{number:!0}]]),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>k.value=l),type:"number",placeholder:"Êï∞Èáè",class:"w-20 border rounded px-3 py-2",min:"1"},null,512),[[y,k.value,void 0,{number:!0}]]),h(T,{type:"primary",onClick:K},{default:f(()=>t[9]||(t[9]=[q("Ê∑ªÂä†Â∞∫ÂØ∏")])),_:1,__:[9]})])]),e("section",we,[t[12]||(t[12]=e("h3",{class:"mb-2 text-lg font-semibold"},"ÂàáÂâ≤È°πÁõÆ",-1)),e("table",ke,[t[11]||(t[11]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"border px-3 py-2"},"Ê†áÁ≠æ"),e("th",{class:"border px-3 py-2"},"ÂÆΩ(cm)"),e("th",{class:"border px-3 py-2"},"È´ò(cm)"),e("th",{class:"border px-3 py-2"},"Êï∞Èáè"),e("th",{class:"border px-3 py-2"},"Êìç‰Ωú")])],-1)),e("tbody",null,[(m(!0),c(D,null,L(d.value,(l,n)=>(m(),c("tr",{key:n,class:"hover:bg-gray-50"},[e("td",Ce,o(l.label),1),e("td",Me,o(l.width.toFixed(1)),1),e("td",Te,o(l.height.toFixed(1)),1),e("td",Ie,o(l.quantity),1),e("td",Ne,[e("button",{class:"text-sm text-red-600",onClick:W=>Y(n)},"Âà†Èô§",8,Ve)])]))),128))])])]),e("section",Fe,[t[14]||(t[14]=e("h3",{class:"mb-3 text-lg font-semibold"},"Â∫ìÂ≠òÊùêÊñô",-1)),e("div",We,[b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>V.value=l),type:"text",placeholder:"ÊùêÊñôÂêçÁß∞",class:"border rounded px-3 py-2"},null,512),[[y,V.value]]),b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>C.value=l),type:"number",placeholder:"ÂÆΩ(cm)",step:"0.1",min:"0.1",class:"w-24 border rounded px-3 py-2"},null,512),[[y,C.value,void 0,{number:!0}]]),b(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>M.value=l),type:"number",placeholder:"È´ò(cm)",step:"0.1",min:"0.1",class:"w-24 border rounded px-3 py-2"},null,512),[[y,M.value,void 0,{number:!0}]]),b(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>F.value=l),type:"number",placeholder:"Êï∞Èáè",class:"w-20 border rounded px-3 py-2",min:"1"},null,512),[[y,F.value,void 0,{number:!0}]]),h(T,{type:"primary",onClick:O},{default:f(()=>t[13]||(t[13]=[q("Ê∑ªÂä†ÊùêÊñô")])),_:1,__:[13]})])]),e("section",Se,[t[16]||(t[16]=e("h3",{class:"mb-2 text-lg font-semibold"},"Ââ©‰ΩôÊùêÊñô",-1)),e("table",Ue,[t[15]||(t[15]=e("thead",null,[e("tr",{class:"bg-gray-100"},[e("th",{class:"border px-3 py-2"},"ÂêçÁß∞"),e("th",{class:"border px-3 py-2"},"ÂÆΩ(cm)"),e("th",{class:"border px-3 py-2"},"È´ò(cm)"),e("th",{class:"border px-3 py-2"},"Êï∞Èáè"),e("th",{class:"border px-3 py-2"},"Êìç‰Ωú")])],-1)),e("tbody",null,[(m(!0),c(D,null,L(x.value,(l,n)=>(m(),c("tr",{key:n,class:"hover:bg-gray-50"},[e("td",qe,o(l.name),1),e("td",ze,o(l.width.toFixed(1)),1),e("td",Ae,o(l.height.toFixed(1)),1),e("td",Be,o(l.count),1),e("td",Ee,[e("button",{class:"text-sm text-red-600",onClick:W=>ee(n)},"Âà†Èô§",8,Re)])]))),128))])])]),e("div",$e,[h(T,{type:"primary",onClick:ae},{default:f(()=>t[17]||(t[17]=[q("ÂºÄÂßãË£ÅÂâ™")])),_:1,__:[17]}),h(T,{type:"warning",onClick:te},{default:f(()=>t[18]||(t[18]=[q("Ê∏ÖÁ©∫ÊâÄÊúâ")])),_:1,__:[18]})])]),_:1}),h(a,{title:"ÁªìÊûúÁªüËÆ°",size:"large",class:"mb-4"},{default:f(()=>[e("p",null,"ÊÄªÈ°πÁõÆÊï∞: "+o(j.value)+" (Èù¢ÁßØ: "+o(Q.value.toFixed(1))+" cm¬≤), Ââ©‰ΩôÊùêÊñô: "+o(x.value.length)+" Áßç",1)]),_:1}),v.value.length?(m(),c("div",He,[e("h3",Pe,"‰ºòÂåñÁªìÊûú: ‰ΩøÁî® "+o(v.value.length)+" ÂùóÊùêÊñô, ÊîæÁΩÆ "+o(j.value)+" ‰∏™È°πÁõÆ",1),(m(!0),c(D,null,L(v.value,(l,n)=>(m(),c("div",{key:n,class:be(["bin-card overflow-hidden border rounded-lg",{"border-green-400 bg-green-50":A(l),"border-blue-400 bg-blue-50":!A(l)}])},[e("div",De,[e("h3",Le,o(l.materialType||"ÊùêÊñô"),1),e("p",je,[q(" ID: "+o(l.binId)+" | Â∞∫ÂØ∏: "+o((l.materialWidth*100).toFixed(1))+"√ó"+o((l.materialHeight*100).toFixed(1))+"cm | Âà©Áî®Áéá: "+o(l.utilization.toFixed(1))+"% ",1),A(l)?(m(),c("span",Ke,"‚ôªÔ∏è Ââ©‰ΩôÊùêÊñô")):(m(),c("span",Oe,"üÜï Êñ∞ÊùêÊñô"))])]),e("canvas",{ref_for:!0,ref:W=>H.value[n]=W,class:"block bg-white"},null,512)],2))),128))])):pe("",!0),h(I,{show:z.value,"onUpdate:show":t[8]||(t[8]=l=>z.value=l),preset:"dialog",title:"ËÆ°ÁÆó‰∏≠..."},{default:f(()=>[e("div",Xe,[h(p,{size:"large"}),t[19]||(t[19]=e("div",{class:"mt-3"},"Ê≠£Âú®ËÆ°ÁÆóÔºåËØ∑Á®çÂÄô...",-1))])]),_:1},8,["show"])])}}});export{Qe as default};
